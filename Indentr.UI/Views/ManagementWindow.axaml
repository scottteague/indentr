<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:models="clr-namespace:Indentr.Core.Models;assembly=Indentr.Core"
        x:Class="Indentr.UI.Views.ManagementWindow"
             Icon="avares://Indentr.UI/Assets/icon.png"
        Title="Manage Notes"
        Width="800" Height="600"
        WindowStartupLocation="CenterScreen">

    <TabControl Margin="8">

        <!-- ── Orphan Notes ─────────────────────────────────────────── -->
        <TabItem Header="Orphan Notes">
            <Grid RowDefinitions="*,Auto" Margin="4">
                <ListBox x:Name="OrphanList" Grid.Row="0" SelectionMode="Single"
                         SelectionChanged="OnOrphanSelected">
                    <ListBox.ItemTemplate>
                        <DataTemplate x:DataType="models:Note">
                            <TextBlock Text="{Binding Title}" Padding="4,2" />
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>

                <StackPanel Grid.Row="1" Orientation="Horizontal" Spacing="8" Margin="0,8,0,0">
                    <Button x:Name="LinkOrphanButton"   Content="Link to Parent…"
                            IsEnabled="False" Click="OnLinkOrphanClicked" />
                    <Button x:Name="DeleteOrphanButton" Content="Delete"
                            IsEnabled="False" Click="OnDeleteOrphanClicked" />
                    <Button Content="Refresh" Click="OnRefreshOrphans" />
                </StackPanel>
            </Grid>
        </TabItem>

        <!-- ── Tree Browser ─────────────────────────────────────────── -->
        <TabItem Header="Tree Browser" x:Name="TreeTab">
            <Grid RowDefinitions="*,Auto" Margin="4">
                <TreeView x:Name="NoteTree" Grid.Row="0"
                          SelectionMode="Single"
                          SelectionChanged="OnTreeNodeSelected"
                          DoubleTapped="OnTreeNodeDoubleTapped">
                    <TreeView.Styles>
                        <Style Selector="TreeViewItem">
                            <Setter Property="IsExpanded" Value="{ReflectionBinding IsExpanded}" />
                        </Style>
                    </TreeView.Styles>
                    <TreeView.ItemTemplate>
                        <TreeDataTemplate x:DataType="models:NoteTreeNode"
                                          ItemsSource="{Binding Children}">
                            <TextBlock Text="{Binding Title}" />
                        </TreeDataTemplate>
                    </TreeView.ItemTemplate>
                </TreeView>

                <StackPanel Grid.Row="1" Orientation="Horizontal" Spacing="8" Margin="0,8,0,0">
                    <Button x:Name="OpenNoteButton"      Content="Open Note"
                            IsEnabled="False" Click="OnOpenNoteClicked" />
                    <Button x:Name="SelectParentButton"  Content="Insert Link in Parent Note"
                            IsEnabled="False" Click="OnSelectParentClicked" />
                </StackPanel>
            </Grid>
        </TabItem>

        <!-- ── Shared Notes ──────────────────────────────────────────── -->
        <TabItem Header="Shared Notes">
            <Grid RowDefinitions="*,Auto" Margin="4">
                <TreeView x:Name="SharedTree" Grid.Row="0"
                          SelectionMode="Single"
                          SelectionChanged="OnSharedNodeSelected"
                          DoubleTapped="OnSharedNodeDoubleTapped">
                    <TreeView.Styles>
                        <Style Selector="TreeViewItem">
                            <Setter Property="IsExpanded" Value="{ReflectionBinding IsExpanded}" />
                        </Style>
                    </TreeView.Styles>
                    <TreeView.ItemTemplate>
                        <TreeDataTemplate x:DataType="models:NoteTreeNode"
                                          ItemsSource="{Binding Children}">
                            <TextBlock Text="{Binding Title}" />
                        </TreeDataTemplate>
                    </TreeView.ItemTemplate>
                </TreeView>

                <StackPanel Grid.Row="1" Orientation="Horizontal" Spacing="8" Margin="0,8,0,0">
                    <Button x:Name="OpenSharedNoteButton"     Content="Open Note"
                            IsEnabled="False" Click="OnOpenSharedNoteClicked" />
                    <Button x:Name="CopySharedLinkButton"     Content="Copy Link"
                            IsEnabled="False" Click="OnCopySharedLinkClicked" />
                    <Button Content="Refresh" Click="OnRefreshShared" />
                </StackPanel>
            </Grid>
        </TabItem>

    </TabControl>
</Window>
