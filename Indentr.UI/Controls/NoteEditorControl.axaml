<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:ae="clr-namespace:AvaloniaEdit;assembly=AvaloniaEdit"
             x:Class="Indentr.UI.Controls.NoteEditorControl">

    <DockPanel>
        <!-- Toolbar -->
        <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Spacing="4" Margin="4,4,4,0">
            <Button x:Name="BoldButton"         Content="B"            FontWeight="Bold"   Width="32" ToolTip.Tip="Bold (**text**)"          Click="OnBoldClick" />
            <Button x:Name="RedButton"          Content="R"            Foreground="Red"    Width="32" ToolTip.Tip="Red (__text__)"            Click="OnRedClick" />
            <Button x:Name="ItalicButton"       Content="I"            FontStyle="Italic"  Width="32" ToolTip.Tip="Italic (*text*)"           Click="OnItalicClick" />
            <Button x:Name="UnderlineButton"    Content="U"            Width="32"          ToolTip.Tip="Underline (_text_)"                  Click="OnUnderlineClick" />
            <Button x:Name="LinkButton"         Content="ðŸ”—"           Width="32"          ToolTip.Tip="Insert link"                         Click="OnLinkClick" />
            <Button x:Name="NewChildNoteButton" Content="+ Note"       Width="72"          ToolTip.Tip="Create child note from selection"    Click="OnNewChildNoteClick" IsEnabled="False" />
            <Button x:Name="NewBoardButton"     Content="+ Board"    Width="90"          ToolTip.Tip="Create a new kanban board"           Click="OnNewBoardClick"     IsEnabled="False" />
            <Separator Width="1" />
            <Button x:Name="SaveButton"         Content="Save"         Width="50"          ToolTip.Tip="Save (Ctrl+S)"                       Click="OnSaveClick" />
            <Button x:Name="ExportButton"       Content="Exportâ€¦"      Width="70"          ToolTip.Tip="Export to Markdown"                  Click="OnExportClick" />
            <Button x:Name="ExportSubtreeButton" Content="Export Subtreeâ€¦" Width="120"
                    ToolTip.Tip="Export this note and all children to a folder"
                    Click="OnExportSubtreeClick" IsEnabled="False" />
        </StackPanel>

        <!-- Save error banner (hidden by default) -->
        <Border DockPanel.Dock="Top" x:Name="SaveErrorBanner" IsVisible="False"
                Background="#FFEEEE" Padding="8,4">
            <TextBlock Text="Save failed â€” check database connection."
                       Foreground="#CC0000" FontSize="12" />
        </Border>

        <!-- Title row (hidden for scratchpad) -->
        <Grid DockPanel.Dock="Top" ColumnDefinitions="Auto,*" Margin="6,4,6,0" x:Name="TitleRow">
            <TextBlock Grid.Column="0" Text="Title: " VerticalAlignment="Center" />
            <TextBox   Grid.Column="1" x:Name="TitleBox" Watermark="Note title" />
        </Grid>

        <!-- Privacy row (hidden for scratchpad and root note) -->
        <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Margin="6,2,6,0" x:Name="PrivacyRow">
            <CheckBox x:Name="PublicCheckBox" Content="Public" ToolTip.Tip="Uncheck to make this note private (visible only to you)" />
        </StackPanel>

        <!-- Attachment bar (hidden for scratchpad; shown when a note is loaded) -->
        <Border DockPanel.Dock="Bottom" x:Name="AttachmentBar"
                BorderThickness="0,1,0,0" Padding="4,3,4,3" IsVisible="False">
            <DockPanel>
                <Button DockPanel.Dock="Left" Content="ðŸ“Ž Attach" Margin="0,0,6,0"
                        ToolTip.Tip="Attach a file to this note" Click="OnAttachClick" />
                <ScrollViewer HorizontalScrollBarVisibility="Auto"
                              VerticalScrollBarVisibility="Disabled">
                    <StackPanel x:Name="AttachmentPanel" Orientation="Horizontal" Spacing="4" />
                </ScrollViewer>
            </DockPanel>
        </Border>

        <!-- AvaloniaEdit text editor -->
        <ae:TextEditor x:Name="Editor"
                       FontFamily="Segoe UI,Noto Sans,Liberation Sans,sans-serif"
                       FontSize="14"
                       WordWrap="True"
                       ShowLineNumbers="False"
                       Margin="6,4,6,4"
                       HorizontalScrollBarVisibility="Disabled" />
    </DockPanel>
</UserControl>
